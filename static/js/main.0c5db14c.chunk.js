(this["webpackJsonpe2e-encrypt-chat"]=this["webpackJsonpe2e-encrypt-chat"]||[]).push([[0],{125:function(e,t){},130:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(12),c=n.n(i),s=(n(86),n(81)),o=n(20),u=n(63),l=n.n(u),d=n(26),f=n(36),m=n.n(f),p=n(48),y=n.n(p),b=(n(130),"41ad55e8-69e7-4386-8e3d-128765e09140"),v=localStorage.getItem("userId")||Math.random().toString(10).slice(12);localStorage.setItem("userId",v);var h=new l.a({publishKey:"pub-c-5e44bacc-d9b4-4d11-9462-089626f7f2e6",subscribeKey:"sub-c-347badce-45ed-11ea-aea8-722f8d3d4603",uuid:v}),g=m.a.box.keyPair(),x=function(e){return"https://i.pravatar.cc/36?u=".concat(e)},w=function(e,t){var n=m.a.box.open(new Uint8Array(t.box),new Uint8Array(t.nonce),new Uint8Array(e),g.secretKey);return y.a.encodeUTF8(n)},E=function(e){return e?e.map((function(e){return e.toString(16)})).join("-"):"none"},K=function(e,t){var n=t.action,a=e.users,r=e.messages;if(console.log("Dispatch",n),"join"===n||"state-change"===n||"here-now"===n){var i=t.uuid;if(i===v)return e;a[i]=Object(o.a)({},a[i],{id:i});var c=t.state?t.state.publicKey:null;return c&&(a[i].publicKey=c),Object(o.a)({},e,{users:a})}if("leave"===n||"timeout"===n){var s=t.uuid;return delete a[s],Object(o.a)({},e,{users:a})}if("incoming-messages"===n){var u=t.messages.filter((function(e){return a[e.user.id]&&e.to===v})).map((function(e){var t=a[e.user.id];return Object(o.a)({},e,{text:w(t.publicKey,e.encrypted)})}));return Object(o.a)({},e,{messages:d.GiftedChat.append(r,u)})}return"my-messages"===n?Object(o.a)({},e,{messages:d.GiftedChat.append(r,t.messages)}):e};var j={container:{flex:1,display:"flex",flexDirection:"row",height:"100vh"},conversationList:{display:"flex",flex:1,flexDirection:"column",padding:"12px",overflowY:"scroll"},chat:{display:"flex",flex:3,flexDirection:"column",borderWidth:"1px",borderColor:"#ccc",borderRightStyle:"solid",borderLeftStyle:"solid"},userrec:{display:"flex",flexDirection:"column",padding:"8px",border:"1px solid #aaa"},userId:{display:"flex",flexDirection:"row",fontSize:"16px"},publicKey:{fontSize:"12px"}},A=function(){var e=Object(a.useReducer)(K,{users:{},messages:[]}),t=Object(s.a)(e,2),n=t[0],i=t[1],c=n.users,o=n.messages;Object(a.useEffect)((function(){}),[]),Object(a.useEffect)((function(){var e=Array.from(g.publicKey);h.setState({channels:[b],state:{publicKey:e}}),h.hereNow({channels:[b],includeState:!0},(function(e,t){t.channels[b].occupants.forEach((function(e){i({action:"here-now",uuid:e.uuid,state:{publicKey:e.state?e.state.publicKey:null}})}))}));var t={message:function(e){var t=e.message;t.action="incoming-messages",i(t)},presence:function(e){i(e)}};return h.subscribe({channels:[b],withPresence:!0}),h.addListener(t),function(){h.unsubscribe({channels:[b]}),h.removeListener(t)}}),[]);var u=function(e){i({action:"my-messages",messages:e}),Object.values(c).filter((function(e){return e.id!==v})).forEach((function(t){var n=t.publicKey,a=e.map((function(e){var a=e.createdAt,r=e.text,i=e.id,c=function(e,t){var n=m.a.randomBytes(24),a=m.a.box(y.a.decodeUTF8(t),n,new Uint8Array(e),g.secretKey);return{box:Array.from(a),nonce:Array.from(n)}}(n,r);return{createdAt:a,user:e.user,encrypted:c,id:i,to:t.id}}));h.publish({channel:b,message:{messages:a}})}))};return r.a.createElement("div",{className:"App",style:j.container},r.a.createElement("div",{style:j.conversationList},r.a.createElement("div",{style:j.userrec},r.a.createElement("div",{style:j.userId},r.a.createElement(d.GiftedAvatar,{user:{id:v,avatar:x(v)}}),v),r.a.createElement("div",{style:j.publicKey},"Public key: ",E(Array.from(g.publicKey)))),r.a.createElement("h2",null,"Participants"),Object.values(c).map((function(e){return r.a.createElement("div",{key:e.id,style:j.userrec},r.a.createElement("div",{style:j.userId},r.a.createElement(d.GiftedAvatar,{user:{id:e.id,avatar:x(e.id)}}),e.id),r.a.createElement("div",{style:j.publicKey},"Public key: ",E(e.publicKey)))}))),r.a.createElement("div",{style:j.chat},r.a.createElement(d.GiftedChat,{messages:o,onSend:function(e){return u(e)},user:{id:v,name:v.toString(),avatar:x(v)}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},82:function(e,t,n){e.exports=n(132)},86:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.0c5db14c.chunk.js.map